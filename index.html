<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Traffic Citation Reporter</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        .container { margin-bottom: 20px; }
        label { display: block; margin-top: 10px; }
        input, button { margin-top: 5px; }
    </style>
</head>
<body>
    <div id="report" class="container">
        <h2>Report a Citation</h2>
        <label for="citationNumber">Citation Number:</label>
        <input type="text" id="citationNumber" required>
        
        <label for="timeOccurred">Time Occurred:</label>
        <input type="datetime-local" id="timeOccurred" required>
        
        <label for="locationOccurred">Location Occurred:</label>
        <input type="text" id="locationOccurred" required>
        
        <label for="licensePlate">License Plate Number:</label>
        <input type="text" id="licensePlate" required>
        
        <button id="submitCitation">Report a Citation</button>
    </div>
    <div id="list" class="container">
        <h2>Citation List</h2>
    </div>

    <script>



	document.addEventListener('DOMContentLoaded', function() {
    var password = prompt("Please enter the password to view license plate data:");
    if (password !== null) {
        // Send the password to the server to verify
        verifyPassword(password);
    }
});

function verifyPassword(password) {
    fetch('https://thawing-bayou-15449-25148cb91854.herokuapp.com/api/verify', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ password })
    })
    .then(response => response.json())
    .then(data => {
        if (data.accessGranted) {
            fetchCitations(); // Only fetch if password is correct
        } else {
            alert('Access denied. Incorrect password.');
        }
    })
    .catch(error => console.error('Error:', error));
}

// Rest of your code to fetch and display citations goes here


        document.getElementById("submitCitation").addEventListener("click", function() {
            const citationNumber = document.getElementById("citationNumber").value;
            const timeOccurred = document.getElementById("timeOccurred").value;
            const locationOccurred = document.getElementById("locationOccurred").value;
            const licensePlate = document.getElementById("licensePlate").value;
            
            fetch('https://thawing-bayou-15449-25148cb91854.herokuapp.com/api/citations', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({
                    citationNumber,
                    timeOccurred,
                    locationOccurred,
                    licensePlate,
                }),
            })
            .then(response => response.json())
            .then(data => {
                console.log('Success:', data);
                fetchCitations(); // Refresh the list after submitting
            })
            .catch((error) => {
                console.error('Error:', error);
            });
        });

        function fetchCitations() {
    fetch('https://thawing-bayou-15449-25148cb91854.herokuapp.com/api/citations')
        .then(response => response.json())
        .then(data => {
            const listDiv = document.getElementById("list");
            listDiv.innerHTML = "<h2>Citation List</h2>"; // Clear current list and add header again
            
            data.forEach(citation => {
                const p = document.createElement("p");
                p.textContent = `License Plate: ${citation.licensePlate}`;
                listDiv.appendChild(p);
            });
        })
        .catch((error) => console.error('Error:', error));
}


        // Initially fetch citations to populate the list
        fetchCitations();
		
		
		setInterval(fetchCitations, 30000);
    </script>
</body>
</html>
